# インシデント管理システム要件定義書

## 1. システム概要

### 1.1 目的
Slackの指定チャンネルから投稿内容を取得し、インシデントレベルを分析・管理するWebシステムを構築する。

### 1.2 主要機能
- Slackチャンネルの投稿内容およびスレッドの取得
- インシデントレベルの自動分類・評価
- 取得データの永続化と分析
- セキュアなユーザー認証

### 1.3 技術スタック
- フロントエンド/バックエンド: Next.js (App Router)
- データベース: Neon (PostgreSQL)
- ホスティング: Vercel
- 認証: NextAuth.js
- UI: WCAG2.2準拠のアクセシブルデザイン

## 2. インシデント評価基準

### 2.1 緊急度
- **高**: 暫定対応を策定して即時ユーザーに対してアクションが必要な事象
- **中**: 対応しないとユーザーにクリティカルな影響が出る可能性がある事象
- **低**: 対応しないとユーザーに影響が出る可能性がある事象

### 2.2 影響度
- **高**: ほぼすべてのユーザーに影響がある事象
- **中**: 複数のユーザーに影響がある事象
- **低**: 特定ユーザーに影響がある事象

### 2.3 インシデント分類
- **障害**: 緊急度が中以上、または影響度が高のもの
- **不具合**: 上記以外のもの

## 3. 機能要件

### 3.1 認証機能
- メールアドレスとパスワードによるログイン
- 新規ユーザー登録機能は非公開（シードデータでのみ追加）
- セッション管理
- ログアウト機能

### 3.2 Slackチャンネル管理
- チャンネルの追加・削除（複数チャンネル対応）
- チャンネルID/名前の登録
- チャンネルの有効/無効切り替え

### 3.3 Slackデータ取得機能
- 指定期間でのデータ取得
- 投稿内容とスレッドの完全取得
- Slack APIレート制限への対応（適切な待機処理）
- 取得データのDB保存（生データ保存）
- 差分取得機能（新規投稿のみ取得）

### 3.4 インシデント分析機能
- 取得したSlackメッセージの一覧表示
- 緊急度・影響度の手動設定
- インシデントレベル（障害/不具合）の自動判定
- フィルタリング機能（期間、緊急度、影響度、インシデントレベル）
- 検索機能（キーワード検索）

### 3.5 レポート機能
- インシデント統計の表示
- 期間別インシデント推移
- CSVエクスポート機能

## 4. 非機能要件

### 4.1 セキュリティ
- パスワードのハッシュ化（bcrypt）
- HTTPSによる通信
- CSRF対策
- SQLインジェクション対策
- 環境変数による機密情報管理

### 4.2 パフォーマンス
- ページロード時間: 3秒以内
- Slack API呼び出しの最適化
- データベースクエリの最適化
- ページネーション実装

### 4.3 アクセシビリティ（WCAG 2.2準拠）
- レベルAA準拠
- キーボードナビゲーション対応
- スクリーンリーダー対応
- 十分なコントラスト比
- フォーカスインジケータの明確化
- エラーメッセージの適切な表示

### 4.4 可用性
- Vercelの自動スケーリング活用
- エラーハンドリングの実装
- 適切なエラーメッセージ表示

## 5. データベース設計

### 5.1 主要テーブル
- **users**: ユーザー情報
- **channels**: Slackチャンネル情報
- **slack_messages**: 取得したSlackメッセージ（生データ）
- **incidents**: インシデント情報（分析結果）
- **fetch_history**: データ取得履歴

### 5.2 データ保存方針
- Slackから取得したデータは加工せず生データとして保存
- 分析結果は別テーブルで管理
- 定期的なバックアップ推奨

## 6. API設計

### 6.1 内部API（Next.js API Routes）
- `/api/auth/*`: 認証関連
- `/api/channels/*`: チャンネル管理
- `/api/slack/fetch`: Slackデータ取得
- `/api/incidents/*`: インシデント管理
- `/api/reports/*`: レポート生成

### 6.2 外部API
- Slack Web API（conversations.history, conversations.replies）

## 7. 画面設計

### 7.1 画面一覧
1. ログイン画面
2. ダッシュボード
3. チャンネル管理画面
4. データ取得画面
5. インシデント一覧画面
6. インシデント詳細画面
7. レポート画面

### 7.2 レスポンシブデザイン
- デスクトップ、タブレット、モバイル対応
- ブレークポイント: 640px, 768px, 1024px

## 8. 初期データ

### 8.1 初期ユーザー
- メールアドレス: ykto@taylormode.co.jp
- パスワード: Root123!3030

## 9. 開発スケジュール（推奨）

1. **フェーズ1**: 基本機能実装
   - 認証機能
   - データベース設計・実装
   - 基本的なUI構築

2. **フェーズ2**: Slack連携
   - Slack API連携
   - データ取得・保存機能
   - レート制限対応

3. **フェーズ3**: 分析機能
   - インシデント分析機能
   - レポート機能
   - フィルタリング・検索機能

4. **フェーズ4**: 品質向上
   - WCAG2.2準拠の確認・修正
   - パフォーマンス最適化
   - エラーハンドリング強化

## 10. 制約事項

- Slack APIのレート制限を遵守
- Neonの無料プランの制限を考慮（必要に応じて有料プラン検討）
- Vercelの無料プランの制限を考慮（必要に応じて有料プラン検討）

## 11. 今後の拡張可能性

- 自動インシデント検知（キーワードベース）
- 通知機能（重要インシデント発生時）
- 複数組織対応（マルチテナント）
- AIによるインシデント分類の自動化
