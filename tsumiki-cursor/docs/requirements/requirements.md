# インシデント管理システム要件定義書

## プロジェクト情報
- **プロジェクト名**: インシデント管理システム
- **バージョン**: 1.0.0
- **作成日**: 2025-08-24
- **更新日**: 2025-08-24

## 1. 背景と目的

### 1.1 背景
現在、Slackチャンネルで報告されるインシデント情報が散在しており、緊急度や影響度の判定、対応状況の追跡が困難な状態にある。インシデントの重要度を適切に評価し、組織的な対応を可能にするシステムが必要とされている。

### 1.2 目的
Slackの指定チャンネルから投稿内容を自動的に取得し、インシデントレベルを分析・管理することで、以下を実現する：
- インシデントの一元管理
- 緊急度・影響度に基づく適切な優先順位付け
- 迅速な障害対応の実現
- インシデント傾向の可視化

### 1.3 期待される効果
- インシデント対応時間の短縮（30%削減目標）
- 重要インシデントの見逃し防止（ゼロ化）
- 対応履歴の蓄積による知見の共有
- データに基づく改善施策の立案

## 2. スコープ

### 2.1 対象範囲
- Slackチャンネルからのメッセージおよびスレッド取得
- インシデントの緊急度・影響度評価
- インシデントデータの永続化と検索
- 統計レポートの生成
- ユーザー認証・認可
- WCAG2.2準拠のWebインターフェース

### 2.2 対象外範囲
- Slack以外のチャットツールとの連携
- 自動インシデント対応（初期リリースでは手動対応）
- 外部システムへの通知機能（将来的に実装予定）
- 新規ユーザーのセルフ登録（管理者による登録のみ）

## 3. 機能要件

### 3.1 必須機能

#### 認証・認可機能
- メールアドレスとパスワードによるログイン
- セッション管理（タイムアウト：8時間）
- ログアウト機能
- パスワードリセット機能（管理者経由）

#### Slackチャンネル管理
- チャンネルの追加・編集・削除（CRUD操作）
- 複数チャンネルの同時管理
- チャンネルの有効/無効切り替え
- Slack APIトークンの安全な管理

#### Slackデータ取得
- 指定期間（開始日時・終了日時）でのデータ取得
- 投稿メッセージとスレッドの完全取得
- Slack APIレート制限対応（Tier 2: 20リクエスト/分）
- 取得データの生データ保存
- 差分取得機能（前回取得以降の新規投稿のみ）
- 取得履歴の記録

#### 自動判定ルール設定
- 緊急度判定ルール
  - キーワードベース（例：「緊急」「至急」「クリティカル」「停止」「障害」）
  - パターンマッチング（正規表現対応）
  - カスタムルールの追加・編集・削除
- 影響度判定ルール
  - 影響ユーザー数の推定（例：「全ユーザー」「複数ユーザー」「特定ユーザー」）
  - サービス名・機能名からの影響範囲推定
  - カスタムルールの追加・編集・削除
- 判定ルールのインポート・エクスポート機能

#### インシデント分析・管理
- Slackメッセージ一覧表示（ページネーション対応）
- 緊急度（高・中・低）の自動判定（キーワード・パターンマッチング）
- 影響度（高・中・低）の自動判定（影響範囲の推定）
- 緊急度・影響度の手動変更機能
- インシデントレベル（障害/不具合）の自動判定
- ステータス管理（未対応・対応中・完了）
- 担当者割り当て
- 対応メモの記録

#### 検索・フィルタリング
- キーワード検索（全文検索）
- 期間フィルター
- 緊急度・影響度フィルター
- インシデントレベルフィルター
- ステータスフィルター
- 複合条件での絞り込み

#### レポート機能
- ダッシュボード表示
  - 本日の新規インシデント数
  - 未対応インシデント数
  - インシデントレベル別集計
- 期間別インシデント推移グラフ
- 緊急度・影響度別分布
- CSVエクスポート機能

### 3.2 オプション機能
- Slackへの返信機能（インシデント対応状況の通知）
- 定期的な自動データ取得（cron連携）
- AIによるインシデント分類支援の高度化

## 4. 非機能要件

### 4.1 パフォーマンス
- ページロード時間：3秒以内（90パーセンタイル）
- API応答時間：1秒以内（単純なクエリ）
- 同時接続ユーザー数：50人以上
- データ取得処理：1000メッセージ/分以上
- 検索応答時間：2秒以内（10万件のデータに対して）

### 4.2 セキュリティ
- パスワードハッシュ化（bcrypt、コスト係数12）
- HTTPS通信の強制
- CSRF対策（トークンベース）
- SQLインジェクション対策（パラメータバインディング）
- XSS対策（適切なエスケープ処理）
- 環境変数による機密情報管理
- Slack APIトークンの暗号化保存
- セッションの安全な管理
- 監査ログの記録

### 4.3 可用性
- 稼働率：99.5%以上（月間）
- 自動スケーリング対応（Vercel）
- エラー時の適切なフォールバック
- データベースの自動バックアップ（日次）
- 障害時の迅速な復旧（RTO: 4時間）

### 4.4 保守性
- モジュラー設計による高い保守性
- 包括的なエラーログ記録
- 開発・ステージング・本番環境の分離
- CI/CDパイプラインの構築
- コードカバレッジ80%以上
- TypeScriptによる型安全性

### 4.5 拡張性
- マイクロサービス志向のアーキテクチャ
- APIファーストの設計
- プラグイン機構の考慮
- 水平スケーリング対応
- 将来的な機能追加を考慮したDB設計

## 5. データベース設計

### 5.1 主要テーブル
- **users**: ユーザー情報
- **channels**: Slackチャンネル情報
- **slack_messages**: 取得したSlackメッセージ（生データ）
- **incidents**: インシデント情報（分析結果）
- **fetch_history**: データ取得履歴
- **urgency_rules**: 緊急度判定ルール
- **impact_rules**: 影響度判定ルール

### 5.2 データ保存方針
- Slackから取得したデータは加工せず生データとして保存
- 分析結果は別テーブルで管理
- 定期的なバックアップ推奨

## 6. API設計

### 6.1 内部API（Next.js API Routes）
- `/api/auth/*`: 認証関連
- `/api/channels/*`: チャンネル管理
- `/api/slack/fetch`: Slackデータ取得
- `/api/incidents/*`: インシデント管理
- `/api/reports/*`: レポート生成
- `/api/rules/*`: 判定ルール管理

### 6.2 外部API
- Slack Web API（conversations.history, conversations.replies）

## 7. 画面設計

### 7.1 画面一覧
1. ログイン画面
2. ダッシュボード
3. チャンネル管理画面
4. データ取得画面
5. インシデント一覧画面
6. インシデント詳細画面
7. レポート画面
8. 判定ルール設定画面

### 7.2 レスポンシブデザイン
- デスクトップ、タブレット、モバイル対応
- ブレークポイント: 640px, 768px, 1024px

## 8. 初期データ

### 8.1 初期ユーザー
- メールアドレス: ykto@taylormode.co.jp
- パスワード: Root123!3030

## 9. 制約事項

### 9.1 技術的制約
- フロントエンド/バックエンド：Next.js 14以上（App Router使用）
- データベース：Neon（PostgreSQL互換）
- ホスティング：Vercel
- Node.js：18.x以上
- Slack API：Web API使用（RTM API非使用）
- ブラウザサポート：Chrome/Edge/Firefox/Safari最新2バージョン

### 9.2 業務的制約
- 新規ユーザー登録は管理者のみ実施可能
- 初期ユーザーはシードデータで作成
- Slackワークスペースへのアプリインストール権限が必要
- 個人情報の取り扱いは社内規定に準拠
- 表示言語は日本語のみ対応

### 9.3 リソース制約
- 開発期間：3ヶ月
- 開発リソース：フルスタックエンジニア1-2名
- インフラコスト：月額$100以内（初期想定）
- Neon無料プラン：ストレージ3GB、コンピュート時間300時間/月
- Vercel無料プラン：100GB帯域幅/月

## 10. 前提条件
- Slackワークスペースが既に存在し、アプリのインストール権限がある
- 対象となるSlackチャンネルへのアクセス権限がある
- インターネット接続が常時可能な環境
- 最新のWebブラウザを使用
- JavaScriptが有効化されている

## 11. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|-------|-------|---------|------|
| Slack APIレート制限超過 | 高 | 中 | バックオフ戦略実装、取得間隔の最適化 |
| データベース容量超過 | 中 | 低 | 古いデータのアーカイブ機能、有料プラン移行計画 |
| セキュリティ侵害 | 高 | 低 | 定期的なセキュリティ監査、脆弱性スキャン |
| パフォーマンス劣化 | 中 | 中 | インデックス最適化、キャッシュ戦略 |
| Slack API仕様変更 | 中 | 低 | API変更の監視、抽象化レイヤーの実装 |

## 12. 成功基準
- 全ての必須機能が実装され、正常に動作すること
- パフォーマンス要件を満たすこと
- セキュリティ要件を満たすこと
- WCAG2.2レベルAAに準拠すること
- ユーザビリティテストで満足度80%以上
- 本番環境で1ヶ月間安定稼働すること

## 13. 用語定義

| 用語 | 定義 |
|------|------|
| インシデント | システムやサービスに影響を与える可能性のある事象 |
| 緊急度 | 対応の時間的な切迫性を表す指標（高・中・低） |
| 影響度 | 影響を受けるユーザーの範囲を表す指標（高・中・低） |
| 障害 | 緊急度が中以上、または影響度が高のインシデント |
| 不具合 | 障害以外のインシデント |
| スレッド | Slackメッセージに対する返信の連なり |
| チャンネル | Slack上の会話スペース |
| WCAG | Web Content Accessibility Guidelines（Webコンテンツアクセシビリティガイドライン） |
| RTO | Recovery Time Objective（目標復旧時間） |
| 自動判定 | システムがキーワードやパターンに基づいて緊急度・影響度を判定する機能 |
